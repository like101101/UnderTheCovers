name: checksum
on:
  push:
    branches: image-burosa-devS23
jobs:
  checksum:
    runs-on: ubuntu-latest #use the latest ubuntu container image 
    steps:
      - uses: actions/checkout@v3
      - name: Set up Python
        uses: actions/setup-python@v4 #use action to install python
        with:
          python-version: "3.9"

      - name: Pull the most recent image
        run: |
          make pull-priv
      - name: Compare checksum value #creates var with checksum value to be compared 
        run: |
          echo "Getting the image checksum"
          PERMISSIONS_CHECKSUM=$( make checksum )
          QUICK_TRIM=${PERMISSIONS_CHECKSUM::64} #quick_trim is used to get rid of the tailing "-" after the checksum
          echo "Comparing the correct checksum value"
          #*********************************************
          #need to insert correct image CHECKSUM val to compare
          #*********************************************
          CHECKSUM=8b08390195ad9627e8aa5d8886966b62efa1f553fb72110c2f83d4d7438d8865
          if [[ "$QUICK_TRIM == $CHECKSUM" ]]; then
                echo "VERIFICATION COMPLETE"
                echo "SUCCESS" 
          else 
                echo "VERIFICATION COMPLETE"
                echo "FAILURE"
                echo "Here is the image checksum:"
                echo "  $QUICK_TRIM"
                echo "Here is the correct checksum:"
                echo "  $CHECKSUM"
                exit 1
          fi
          